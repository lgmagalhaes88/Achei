<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>achei-app documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	      <link rel="stylesheet" href="../styles/style.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">achei-app documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">












<ol class="breadcrumb">
  <li>Interfaces</li>
  <li>Marker</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/cadastrar-item/cadastrar-item.component.ts</code>
        </p>



        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#draggable">draggable</a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#label">label</a>
                                </li>
                                <li>
                                        <a href="#lat">lat</a>
                                </li>
                                <li>
                                        <a href="#lng">lng</a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="draggable"></a>
                                        <span class="name"><b>draggable</b><a href="#draggable"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>draggable:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="label"></a>
                                        <span class="name"><b>label</b><a href="#label"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>label:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lat"></a>
                                        <span class="name"><b>lat</b><a href="#lat"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lat:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lng"></a>
                                        <span class="name"><b>lng</b><a href="#lng"><span class="icon ion-ios-link"></span></a></span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lng:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                                        </td>
                                    </tr>





                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Component, OnInit, ChangeDetectorRef } from &#x27;@angular/core&#x27;;
import { COMMA, ENTER } from &#x27;@angular/cdk/keycodes&#x27;;
import { MatChipInputEvent, MatDatepickerInputEvent, MatSnackBar, MatStepper } from &#x27;@angular/material&#x27;;
import { FormBuilder, FormGroup, FormArray, Validators } from &#x27;@angular/forms&#x27;;
import { TooltipPosition } from &#x27;@angular/material&#x27;;
import { MouseEvent } from &#x27;@agm/core&#x27;;
import { FormControl } from &#x27;@angular/forms&#x27;;
import { Observable } from &#x27;rxjs&#x27;;
import { map, startWith } from &#x27;rxjs/operators&#x27;;
import { ItemService } from &#x27;../item/shared/item.service&#x27;;
import { SessionService } from &#x27;../auth/session.service&#x27;;
import { Item, ItemEncontrado, ItemPerdido, Tag } from &#x27;../item/shared/item.interface&#x27;;

// just an interface for type safety.
declare interface Marker {
  lat: number;
  lng: number;
  label?: string;
  draggable: boolean;
}

declare type TipoSituacao &#x3D; &#x27;perda&#x27; | &#x27;encontro&#x27;;

@Component({
  selector: &#x27;app-cadastrar-item&#x27;,
  templateUrl: &#x27;./cadastrar-item.component.html&#x27;,
  styleUrls: [&#x27;./cadastrar-item.component.scss&#x27;]
})
export class CadastrarItemComponent implements OnInit {

  visible &#x3D; true;
  selectable &#x3D; true;
  removable &#x3D; true;
  addOnBlur &#x3D; true;
  readonly separatorKeysCodes: number[] &#x3D; [ENTER, COMMA];
  tags: string[] &#x3D; [];
  positionOptions: TooltipPosition &#x3D; &#x27;right&#x27;;
  textareaMaxSize &#x3D; 100;

  // google maps zoom level
  startzoom &#x3D; 8;

  // initial center position for the map
  startlat &#x3D; -11.0234343;
  startlng &#x3D; -51.9324519;
  marker: Marker;

  detalhesFormsGroup: FormGroup;
  localFormsGroup: FormGroup;
  horarioFormGroup: FormGroup;
  imagensFormGroup: FormGroup;

  horaControl &#x3D; new FormControl();
  horasFiltradas: Observable&lt;string[]&gt;;

  minutoControl &#x3D; new FormControl();
  minutosFiltrados: Observable&lt;string[]&gt;;

  horas: string[] &#x3D; [];
  minutos: string[] &#x3D; [];

  tipoSituacao: TipoSituacao;

  constructor(private formBuilder: FormBuilder,
    private changeDetector: ChangeDetectorRef,
    private itemService: ItemService,
    private sessionService: SessionService,
    private notificacao: MatSnackBar
  ) {
    this.marker &#x3D; { lat: 0, lng: 0, draggable: true };
    this.marker.lat &#x3D; -11.0234343;
    this.marker.lng &#x3D; -51.9324519;
    this.marker.draggable &#x3D; true;

    this.addToArray(this.horas, 24);
    this.addToArray(this.minutos, 59);
  }

  private addToArray(array: string[], value: number) {
    for (let i &#x3D; 0; i &lt; value + 1; i++) {
      if (i &lt; 9) {
        array.push(&#x60;0${i}&#x60;);
      } else {
        array.push(&#x60;${i}&#x60;);
      }
    }
  }

  ngOnInit() {

    this.tipoSituacao &#x3D; &#x27;encontro&#x27;;

    this.detalhesFormsGroup &#x3D; this.formBuilder.group({
      titulo: this.formBuilder.control(&#x27;&#x27;, Validators.required),
      tags: this.formBuilder.array([]),
      detalhe: this.formBuilder.control(&#x27;&#x27;)
    });

    this.localFormsGroup &#x3D; this.formBuilder.group({
      latitudeLocal: this.formBuilder.control(&#x27;&#x27;, Validators.required),
      longitudeLocal: this.formBuilder.control(&#x27;&#x27;, Validators.required)
    });

    this.horarioFormGroup &#x3D; this.formBuilder.group({
      dataInicial: this.formBuilder.control(&#x27;&#x27;, Validators.required),
      dataFinal: this.formBuilder.control(&#x27;&#x27;, Validators.required),
      hora: this.formBuilder.control(&#x27;&#x27;, Validators.required),
      minuto: this.formBuilder.control(&#x27;&#x27;, Validators.required)
    });

    this.imagensFormGroup &#x3D; this.formBuilder.group({
      imagem: this.formBuilder.control(&#x27;&#x27;)
    });

    this.horasFiltradas &#x3D; this.horaControl.valueChanges.pipe(
      startWith(&#x27;&#x27;),
      map(value &#x3D;&gt; this._filter(value, this.horas))
    );

    this.minutosFiltrados &#x3D; this.minutoControl.valueChanges.pipe(
      startWith(&#x27;&#x27;),
      map(value &#x3D;&gt; this._filter(value, this.minutos))
    );
  }

  add(event: MatChipInputEvent): void {
    const input &#x3D; event.input;
    const value &#x3D; event.value;

    if ((value || &#x27;&#x27;).trim()) {
      const tags &#x3D; this.detalhesFormsGroup.get(&#x27;tags&#x27;) as FormArray;
      tags.push(this.createItem(value.trim()));
    }

    if (input) {
      input.value &#x3D; &#x27;&#x27;;
    }
  }

  remove(tagIndex: number): void {
    const tags &#x3D; this.detalhesFormsGroup.get(&#x27;tags&#x27;) as FormArray;
    tags.removeAt(tagIndex);
  }

  clickedMarker(label: string, index: number) {
    console.log(&#x60;clicked the marker: ${label || index}&#x60;);
  }

  mapClicked($event: MouseEvent) {
    this.localFormsGroup.get(&#x27;latitudeLocal&#x27;).setValue($event.coords.lat);
    this.localFormsGroup.get(&#x27;longitudeLocal&#x27;).setValue($event.coords.lng);
    this.marker.draggable &#x3D; true;
  }

  markerDragEnd(m: Marker, $event: MouseEvent) {
    console.log(&#x27;dragEnd&#x27;, m, $event);
  }

  private _filter(value: string, array: string[]): string[] {
    return array.filter(option &#x3D;&gt; option.includes(value));
  }

  setFile(event) {
    const reader &#x3D; new FileReader();

    if (event.target.files &amp;&amp; event.target.files.length) {
      const [file] &#x3D; event.target.files;
      reader.readAsDataURL(file);

      reader.onload &#x3D; () &#x3D;&gt; {
        this.imagensFormGroup.get(&#x27;imagem&#x27;).setValue(reader.result.toString());
        this.changeDetector.markForCheck();
      };
    }
  }

  createItem(src: string): FormControl {
    return new FormControl(src);
  }

  selectImg() {
    document.getElementById(&#x27;imgupload&#x27;).click();
  }

  setDefaultDate(event: MatDatepickerInputEvent&lt;Date&gt;) {
    console.log(event.value);
    this.horarioFormGroup.get(&#x27;dataFinal&#x27;).setValue(event.value);
  }

  registrar() {
    this.sessionService.getIdUsuario().subscribe(id &#x3D;&gt; {

      const item: Item &#x3D; {
        titulo: this.detalhesFormsGroup.get(&#x27;titulo&#x27;).value,
        detalhe: this.detalhesFormsGroup.get(&#x27;detalhe&#x27;).value,
        tags: this.getTags(),
        imagem: this.imagensFormGroup.get(&#x27;imagem&#x27;).value,
        regiao: {
          latitude: this.localFormsGroup.get(&#x27;latitudeLocal&#x27;).value,
          longitude: this.localFormsGroup.get(&#x27;longitudeLocal&#x27;).value,
        },
        usuarioId: id,
        dataInicio: this.horarioFormGroup.get(&#x27;dataInicial&#x27;).value.toISOString(),
        dataFim: this.horarioFormGroup.get(&#x27;dataFinal&#x27;).value.toISOString(),
        hora: &#x60;${this.horarioFormGroup.get(&#x27;hora&#x27;).value}:${this.horarioFormGroup.get(&#x27;minuto&#x27;).value}&#x60;
      };

      if (this.tipoSituacao &#x3D;&#x3D;&#x3D; &#x27;encontro&#x27;) {
        const itemEncontrado: ItemEncontrado &#x3D; &lt;ItemEncontrado&gt;item;
        itemEncontrado.devolvido &#x3D; false;

        this.itemService.cadastrarchado(itemEncontrado).then(() &#x3D;&gt; {
          this.cadastroOk();
        });

      } else {

        const itemPerdido: ItemPerdido &#x3D; &lt;ItemPerdido&gt;item;
        itemPerdido.recuperado &#x3D; false;

        this.itemService.cadastrarPerdido(itemPerdido).then(() &#x3D;&gt; {
          this.cadastroOk();
        });
      }
    });
  }

  getTags(): Tag[] {
    const tags &#x3D; this.detalhesFormsGroup.get(&#x27;tags&#x27;).value as [];
    const tagsReturn: Tag[] &#x3D; [];

    for (const tag of tags) {
      console.log(tag);
      tagsReturn.push({ nome: tag });
    }

    return tagsReturn;
  }

  cadastroOk() {
    this.notificacao.open(&#x27;Item cadastrado com sucesso!&#x27;, &#x27;Ok&#x27;, { duration: 2000 });
  }

  goForward(stepper: MatStepper, tipo: TipoSituacao) {
    this.tipoSituacao &#x3D; tipo;
    stepper.next();
  }
}
</code></pre>
    </div>
</div>






                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> result-matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Marker.html';
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>
       <!-- Required to polyfill modern browsers as code is ES5 for IE... -->
       <script src="../js/libs/custom-elements-es5-adapter.js" charset="utf-8" defer></script>
       <script src="../js/menu-wc.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
